# =============================================================================
# Get My Subtitle - Environment Variables Configuration
# =============================================================================
# Copy this file to .env and update with your actual values
# Required variables are marked with [REQUIRED]
# Optional variables have defaults and can be omitted if defaults are acceptable
# =============================================================================

# =============================================================================
# Redis Configuration
# =============================================================================
# Redis is used for job state management and duplicate prevention
REDIS_URL=redis://localhost:6379
REDIS_JOB_TTL_COMPLETED=604800              # 7 days in seconds
REDIS_JOB_TTL_FAILED=259200                # 3 days in seconds
REDIS_JOB_TTL_ACTIVE=0                     # No expiration for active jobs

# =============================================================================
# Duplicate Prevention Configuration
# =============================================================================
# Prevents processing the same video file multiple times within a time window
DUPLICATE_PREVENTION_ENABLED=true          # Enable/disable duplicate prevention
DUPLICATE_PREVENTION_WINDOW_SECONDS=3600   # 1 hour default deduplication window

# =============================================================================
# RabbitMQ Configuration
# =============================================================================
# RabbitMQ is used for message queue and event publishing
RABBITMQ_URL=amqp://guest:guest@localhost:5672/

# =============================================================================
# API Configuration
# =============================================================================
# Manager service API server settings
API_HOST=0.0.0.0                           # Bind to all interfaces
API_PORT=8000                              # API server port

# =============================================================================
# Logging Configuration
# =============================================================================
LOG_LEVEL=INFO                             # Options: DEBUG, INFO, WARNING, ERROR, CRITICAL

# =============================================================================
# OpenSubtitles Configuration
# =============================================================================
# [REQUIRED] OpenSubtitles credentials for downloading subtitles
# Get your account at: https://www.opensubtitles.org/
OPENSUBTITLES_USER_AGENT=get-my-subtitle v1.0
OPENSUBTITLES_USERNAME=
OPENSUBTITLES_PASSWORD=            #  [REQUIRED] Your OpenSubtitles password
OPENSUBTITLES_API_KEY=                     # Legacy - not used, kept for backward compatibility

# OpenSubtitles Retry Configuration
OPENSUBTITLES_MAX_RETRIES=3                # Maximum number of retry attempts
OPENSUBTITLES_RETRY_DELAY=1                # Initial delay in seconds before first retry
OPENSUBTITLES_RETRY_MAX_DELAY=60           # Maximum delay in seconds (backoff cap)
OPENSUBTITLES_RETRY_EXPONENTIAL_BASE=2    # Exponential base for backoff (2 = double each time)

# =============================================================================
# OpenAI Translation Service Configuration
# =============================================================================
# [REQUIRED] OpenAI API key for subtitle translation
# Get your API key at: https://platform.openai.com/
OPENAI_API_KEY=
OPENAI_MODEL=gpt-4o-mini                    # OpenAI model to use for translation
                                            # Recommended: gpt-4o-mini, gpt-4o, or gpt-3.5-turbo (non-reasoning models)
                                            # Note: gpt-5-nano is a reasoning model and may use all tokens for reasoning
OPENAI_MAX_TOKENS=4096                     # Maximum tokens per API request
                                            # For reasoning models (gpt-5-nano), increase to 8192 or 16384 if supported
OPENAI_TEMPERATURE=0.3                     # Lower for consistent translations (0.0-2.0)

# Translation Token Limits
TRANSLATION_MAX_TOKENS_PER_CHUNK=8000       # Maximum tokens per translation chunk
TRANSLATION_TOKEN_SAFETY_MARGIN=0.8        # Safety margin (0.8 = 80% of limit)
TRANSLATION_MAX_SEGMENTS_PER_CHUNK=100     # Maximum segments per chunk
                                            # Recommended: 100-200 for GPT-4o-mini (fastest without errors)
                                            # Up to 300-400 if your server allows large payloads
                                            # Lower values (30-50) for reasoning models like gpt-5-nano

# OpenAI Retry Configuration
OPENAI_MAX_RETRIES=3                        # Maximum number of retry attempts after initial try
OPENAI_RETRY_INITIAL_DELAY=2.0             # Initial delay in seconds before first retry
OPENAI_RETRY_MAX_DELAY=60.0                # Maximum delay in seconds (backoff cap)
OPENAI_RETRY_EXPONENTIAL_BASE=2            # Exponential base for backoff (2 = double each time)

# =============================================================================
# File Storage Configuration
# =============================================================================
# Path where downloaded subtitle files are stored
SUBTITLE_STORAGE_PATH= # Use absolute path for production

# =============================================================================
# Checkpoint Configuration
# =============================================================================
# Checkpointing allows resuming long translations if interrupted
CHECKPOINT_ENABLED=true                    # Enable/disable checkpointing
CHECKPOINT_CLEANUP_ON_SUCCESS=true         # Auto-cleanup checkpoint files after successful completion
CHECKPOINT_STORAGE_PATH=                   # Override checkpoint location (defaults to {subtitle_storage_path}/checkpoints)

# =============================================================================
# Subtitle Language Configuration
# =============================================================================
# Centralized language settings for all subtitle operations
SUBTITLE_DESIRED_LANGUAGE=he               # The goal language (what you want to download)
                                            # ISO 639-1 code (e.g., 'en', 'he', 'es', 'fr')
SUBTITLE_FALLBACK_LANGUAGE=en              # Fallback when desired isn't found (then translated to desired)
                                            # Usually 'en' (English) as it's most commonly available

# =============================================================================
# Jellyfin Integration - General
# =============================================================================
# Jellyfin media server integration settings
JELLYFIN_AUTO_TRANSLATE=true               # Automatically translate subtitles when desired language not found

# =============================================================================
# Jellyfin WebSocket Configuration
# =============================================================================
# Real-time notifications from Jellyfin server
JELLYFIN_URL=                              # Jellyfin server URL (e.g., http://jellyfin.local:8096)
JELLYFIN_API_KEY=                          # [REQUIRED if using Jellyfin] Jellyfin API key
JELLYFIN_WEBSOCKET_ENABLED=true            # Enable WebSocket listener for real-time updates
JELLYFIN_WEBSOCKET_RECONNECT_DELAY=2.0     # Initial reconnection delay in seconds
JELLYFIN_WEBSOCKET_MAX_RECONNECT_DELAY=300.0  # Maximum reconnection delay in seconds
JELLYFIN_FALLBACK_SYNC_ENABLED=true        # Enable periodic fallback sync
JELLYFIN_FALLBACK_SYNC_INTERVAL_HOURS=24   # Fallback sync interval in hours

# =============================================================================
# Scanner Configuration - File System Watcher
# =============================================================================
# File system monitoring for local media files
SCANNER_MEDIA_PATH=/media                  # Path to media directory to watch
SCANNER_WATCH_RECURSIVE=true               # Watch subdirectories recursively
SCANNER_MEDIA_EXTENSIONS=.mp4,.mkv,.avi,.mov,.m4v,.webm  # Comma-separated list of video extensions
SCANNER_DEBOUNCE_SECONDS=2.0               # Seconds to wait for file stability before processing
SCANNER_AUTO_TRANSLATE=false              # Auto-translate after download (for file system watcher)

# =============================================================================
# Scanner Configuration - Webhook Server
# =============================================================================
# HTTP webhook endpoint for Jellyfin webhook plugin
SCANNER_WEBHOOK_HOST=0.0.0.0               # Webhook server host (bind to all interfaces)
SCANNER_WEBHOOK_PORT=8001                  # Webhook server port

