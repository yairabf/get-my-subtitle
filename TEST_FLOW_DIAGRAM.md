# Test Flow Diagrams

Visual representations of what you're testing and how it works.

---

## Complete System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            YOUR TESTING                              â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  Submit Job  â”‚ â”€â”€â”€> â”‚  Watch Job   â”‚ â”€â”€â”€> â”‚ Check Events â”‚      â”‚
â”‚  â”‚  (curl POST) â”‚      â”‚  (curl GET)  â”‚      â”‚  (curl GET)  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚         â”‚                      â”‚                      â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                      â”‚                      â”‚
          â–¼                      â–¼                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       MANAGER API (Port 8000)                        â”‚
â”‚                                                                       â”‚
â”‚  POST /subtitles/download  â”‚  GET /status  â”‚  GET /events           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                                              â–²
          â”‚ Creates Job                                  â”‚ Reads Events
          â–¼                                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       REDIS (Port 6379)                              â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  Job Data        â”‚         â”‚  Event History               â”‚     â”‚
â”‚  â”‚  job:{id}        â”‚         â”‚  job:events:{id}             â”‚     â”‚
â”‚  â”‚  - status        â”‚         â”‚  - [event1, event2, ...]     â”‚     â”‚
â”‚  â”‚  - video_url     â”‚         â”‚                              â”‚     â”‚
â”‚  â”‚  - language      â”‚         â”‚                              â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                                              â–²
          â”‚ Enqueues Task                                â”‚ Updates State
          â–¼                                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    RABBITMQ (Ports 5672, 15672)                      â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Exchange: subtitle.events (topic)                            â”‚  â”‚
â”‚  â”‚                                                                â”‚  â”‚
â”‚  â”‚  Routing Keys:                                                â”‚  â”‚
â”‚  â”‚  - subtitle.download.requested                                â”‚  â”‚
â”‚  â”‚  - subtitle.ready                                             â”‚  â”‚
â”‚  â”‚  - subtitle.translate.requested                               â”‚  â”‚
â”‚  â”‚  - subtitle.translated                                        â”‚  â”‚
â”‚  â”‚  - job.failed                                                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚          â”‚                    â”‚                    â”‚                 â”‚
â”‚          â”‚                    â”‚                    â”‚                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Queue: subtitle.events.consumer                              â”‚ â”‚
â”‚  â”‚  Bindings: subtitle.*, job.*                                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                    â”‚                    â”‚
          â”‚                    â”‚                    â”‚
    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
    â”‚           â”‚       â”‚             â”‚      â”‚           â”‚
    â”‚ Downloaderâ”‚       â”‚ Translator  â”‚      â”‚ Consumer  â”‚
    â”‚  Worker   â”‚       â”‚   Worker    â”‚      â”‚  Service  â”‚
    â”‚           â”‚       â”‚             â”‚      â”‚           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                     â”‚                    â”‚
         â”‚ Publishes           â”‚ Publishes          â”‚ Processes
         â”‚ Events              â”‚ Events             â”‚ Events
         â”‚                     â”‚                    â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                    Updates Redis State
```

---

## Test Flow 1: Subtitle Found (90% probability)

```
YOU                MANAGER         REDIS           RABBITMQ        DOWNLOADER      CONSUMER
 â”‚                   â”‚               â”‚                â”‚               â”‚               â”‚
 â”‚ POST /download    â”‚               â”‚                â”‚               â”‚               â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚               â”‚                â”‚               â”‚               â”‚
 â”‚                   â”‚               â”‚                â”‚               â”‚               â”‚
 â”‚                   â”‚ Create Job    â”‚                â”‚               â”‚               â”‚
 â”‚                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚               â”‚               â”‚
 â”‚                   â”‚ status:       â”‚                â”‚               â”‚               â”‚
 â”‚                   â”‚ QUEUED        â”‚                â”‚               â”‚               â”‚
 â”‚                   â”‚               â”‚                â”‚               â”‚               â”‚
 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â”‚                â”‚               â”‚               â”‚
 â”‚ {job_id, QUEUED}  â”‚               â”‚                â”‚               â”‚               â”‚
 â”‚                   â”‚               â”‚                â”‚               â”‚               â”‚
 â”‚                   â”‚ Publish       â”‚                â”‚               â”‚               â”‚
 â”‚                   â”‚ download      â”‚                â”‚               â”‚               â”‚
 â”‚                   â”‚ requested     â”‚                â”‚               â”‚               â”‚
 â”‚                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚               â”‚               â”‚
 â”‚                   â”‚               â”‚                â”‚               â”‚               â”‚
 â”‚                   â”‚               â”‚                â”‚ Consume Task  â”‚               â”‚
 â”‚                   â”‚               â”‚                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚               â”‚
 â”‚                   â”‚               â”‚                â”‚               â”‚               â”‚
 â”‚                   â”‚               â”‚                â”‚               â”‚ Update Status â”‚
 â”‚                   â”‚               â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ IN_PROGRESS   â”‚
 â”‚                   â”‚               â”‚                â”‚               â”‚               â”‚
 â”‚ GET /status       â”‚               â”‚                â”‚               â”‚               â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚ Get Status    â”‚                â”‚               â”‚               â”‚
 â”‚                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚               â”‚               â”‚
 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ IN_PROGRESS   â”‚                â”‚               â”‚               â”‚
 â”‚ IN_PROGRESS       â”‚               â”‚                â”‚               â”‚               â”‚
 â”‚                   â”‚               â”‚                â”‚               â”‚ Download OK   â”‚
 â”‚                   â”‚               â”‚                â”‚               â”‚               â”‚
 â”‚                   â”‚               â”‚                â”‚               â”‚ Publish       â”‚
 â”‚                   â”‚               â”‚                â”‚               â”‚ subtitle.readyâ”‚
 â”‚                   â”‚               â”‚                â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â”‚
 â”‚                   â”‚               â”‚                â”‚               â”‚               â”‚
 â”‚                   â”‚               â”‚                â”‚ Consume Event â”‚               â”‚
 â”‚                   â”‚               â”‚                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
 â”‚                   â”‚               â”‚                â”‚                               â”‚
 â”‚                   â”‚               â”‚                â”‚               Update Status   â”‚
 â”‚                   â”‚               â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚                   â”‚               â”‚                â”‚               status: DONE    â”‚
 â”‚                   â”‚               â”‚                â”‚               Record Event    â”‚
 â”‚                   â”‚               â”‚                â”‚                               â”‚
 â”‚ GET /status       â”‚               â”‚                â”‚                               â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚ Get Status    â”‚                â”‚                               â”‚
 â”‚                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚                               â”‚
 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ DONE          â”‚                â”‚                               â”‚
 â”‚ DONE âœ“            â”‚               â”‚                â”‚                               â”‚
 â”‚                   â”‚               â”‚                â”‚                               â”‚
 â”‚ GET /events       â”‚               â”‚                â”‚                               â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚ Get Events    â”‚                â”‚                               â”‚
 â”‚                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚                               â”‚
 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ [events]      â”‚                â”‚                               â”‚
 â”‚ [2 events] âœ“      â”‚               â”‚                â”‚                               â”‚
```

**Timeline:**
- t=0s: Job submitted
- t=1s: Status = DOWNLOAD_IN_PROGRESS
- t=2s: Status = DONE
- t=3s: Events = 2 (download.requested, subtitle.ready)

---

## Test Flow 2: Subtitle Not Found â†’ Translation (10% probability)

```
YOU                MANAGER         REDIS           RABBITMQ        DOWNLOADER    TRANSLATOR    CONSUMER
 â”‚                   â”‚               â”‚                â”‚               â”‚              â”‚              â”‚
 â”‚ POST /download    â”‚               â”‚                â”‚               â”‚              â”‚              â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚               â”‚                â”‚               â”‚              â”‚              â”‚
 â”‚                   â”‚               â”‚                â”‚               â”‚              â”‚              â”‚
 â”‚                   â”‚ Create Job    â”‚                â”‚               â”‚              â”‚              â”‚
 â”‚                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚               â”‚              â”‚              â”‚
 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ QUEUED        â”‚                â”‚               â”‚              â”‚              â”‚
 â”‚ {job_id, QUEUED}  â”‚               â”‚                â”‚               â”‚              â”‚              â”‚
 â”‚                   â”‚               â”‚                â”‚               â”‚              â”‚              â”‚
 â”‚                   â”‚ Publish       â”‚                â”‚               â”‚              â”‚              â”‚
 â”‚                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚               â”‚              â”‚              â”‚
 â”‚                   â”‚               â”‚                â”‚               â”‚              â”‚              â”‚
 â”‚                   â”‚               â”‚                â”‚ Consume       â”‚              â”‚              â”‚
 â”‚                   â”‚               â”‚                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚              â”‚              â”‚
 â”‚                   â”‚               â”‚                â”‚               â”‚              â”‚              â”‚
 â”‚                   â”‚               â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚              â”‚
 â”‚                   â”‚               â”‚ status: IN_PROGRESS            â”‚              â”‚              â”‚
 â”‚                   â”‚               â”‚                â”‚               â”‚              â”‚              â”‚
 â”‚                   â”‚               â”‚                â”‚               â”‚ Subtitle     â”‚              â”‚
 â”‚                   â”‚               â”‚                â”‚               â”‚ NOT FOUND    â”‚              â”‚
 â”‚                   â”‚               â”‚                â”‚               â”‚              â”‚              â”‚
 â”‚                   â”‚               â”‚                â”‚               â”‚ Publish      â”‚              â”‚
 â”‚                   â”‚               â”‚                â”‚               â”‚ translate    â”‚              â”‚
 â”‚                   â”‚               â”‚                â”‚               â”‚ requested    â”‚              â”‚
 â”‚                   â”‚               â”‚                â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚              â”‚
 â”‚                   â”‚               â”‚                â”‚               â”‚              â”‚              â”‚
 â”‚                   â”‚               â”‚                â”‚ Consume Event â”‚              â”‚              â”‚
 â”‚                   â”‚               â”‚                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
 â”‚                   â”‚               â”‚                â”‚                              â”‚              â”‚
 â”‚                   â”‚               â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚                   â”‚               â”‚ status: TRANSLATE_QUEUED                     Record Event    â”‚
 â”‚                   â”‚               â”‚                â”‚                              â”‚              â”‚
 â”‚ GET /status       â”‚               â”‚                â”‚                              â”‚              â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚               â”‚                â”‚                              â”‚              â”‚
 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â”‚                â”‚                              â”‚              â”‚
 â”‚ TRANSLATE_QUEUED  â”‚               â”‚                â”‚                              â”‚              â”‚
 â”‚                   â”‚               â”‚                â”‚               Consume Task   â”‚              â”‚
 â”‚                   â”‚               â”‚                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚              â”‚
 â”‚                   â”‚               â”‚                â”‚                              â”‚              â”‚
 â”‚                   â”‚               â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚
 â”‚                   â”‚               â”‚ status: TRANSLATE_IN_PROGRESS                 â”‚              â”‚
 â”‚                   â”‚               â”‚                â”‚                              â”‚              â”‚
 â”‚                   â”‚               â”‚                â”‚                              â”‚ Translate    â”‚
 â”‚                   â”‚               â”‚                â”‚                              â”‚ Complete     â”‚
 â”‚                   â”‚               â”‚                â”‚                              â”‚              â”‚
 â”‚                   â”‚               â”‚                â”‚                              â”‚ Publish      â”‚
 â”‚                   â”‚               â”‚                â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ translated   â”‚
 â”‚                   â”‚               â”‚                â”‚                              â”‚              â”‚
 â”‚                   â”‚               â”‚                â”‚ Consume Event                â”‚              â”‚
 â”‚                   â”‚               â”‚                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
 â”‚                   â”‚               â”‚                â”‚                                             â”‚
 â”‚                   â”‚               â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚                   â”‚               â”‚ status: DONE                                  Record Event   â”‚
 â”‚                   â”‚               â”‚                â”‚                                             â”‚
 â”‚ GET /status       â”‚               â”‚                â”‚                                             â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚               â”‚                â”‚                                             â”‚
 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ DONE âœ“        â”‚                â”‚                                             â”‚
 â”‚                   â”‚               â”‚                â”‚                                             â”‚
 â”‚ GET /events       â”‚               â”‚                â”‚                                             â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚               â”‚                â”‚                                             â”‚
 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ [3 events] âœ“  â”‚                â”‚                                             â”‚
```

**Timeline:**
- t=0s: Job submitted
- t=1s: Status = DOWNLOAD_IN_PROGRESS
- t=2s: Subtitle not found
- t=3s: Status = TRANSLATE_QUEUED
- t=4s: Status = TRANSLATE_IN_PROGRESS
- t=7s: Status = DONE
- t=8s: Events = 3 (download.requested, translate.requested, translated)

---

## Event History Structure

```
GET /subtitles/{job_id}/events

Response:
{
  "job_id": "550e8400-e29b-41d4-a716-446655440000",
  "event_count": 3,
  "events": [
    {
      "event_type": "subtitle.translated",      â† Most Recent
      "timestamp": "2025-10-29T10:10:00Z",
      "source": "translator",
      "payload": {
        "job_id": "550e8400-...",
        "source_language": "en",
        "target_language": "he"
      },
      "metadata": {}
    },
    {
      "event_type": "subtitle.translate.requested",
      "timestamp": "2025-10-29T10:09:30Z",
      "source": "downloader",
      "payload": {
        "job_id": "550e8400-...",
        "reason": "subtitle_not_found"
      },
      "metadata": {}
    },
    {
      "event_type": "subtitle.download.requested",  â† Oldest
      "timestamp": "2025-10-29T10:09:00Z",
      "source": "manager",
      "payload": {
        "job_id": "550e8400-...",
        "video_url": "https://example.com/video.mp4",
        "language": "he"
      },
      "metadata": {}
    }
  ]
}
```

---

## RabbitMQ Event Routing

```
                    subtitle.events (topic exchange)
                              â”‚
                              â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                     â”‚                     â”‚
        â”‚                     â”‚                     â”‚
  Routing Key:          Routing Key:         Routing Key:
  subtitle.*            job.*                test.*
        â”‚                     â”‚                     â”‚
        â”‚                     â”‚                     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                subtitle.events.consumer (queue)
                              â”‚
                              â”‚
                        â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
                        â”‚           â”‚
                    Consumer    Consumer
                    Instance 1  Instance 2
                    (if scaled)
```

**Event Types & Routing:**
- `subtitle.download.requested` â†’ Matches `subtitle.*`
- `subtitle.ready` â†’ Matches `subtitle.*`
- `subtitle.translate.requested` â†’ Matches `subtitle.*`
- `subtitle.translated` â†’ Matches `subtitle.*`
- `job.failed` â†’ Matches `job.*`

---

## Redis Data Structure

```
Redis Keys:

job:{job_id}                          â† Job metadata
â””â”€ JSON: {
     job_id: UUID,
     status: enum,
     video_url: string,
     video_title: string,
     language: string,
     created_at: timestamp,
     updated_at: timestamp,
     metadata: {...}
   }

job:events:{job_id}                   â† Event history (list)
â””â”€ LIST: [
     {event_type, timestamp, source, payload},  â† Most recent
     {event_type, timestamp, source, payload},
     {event_type, timestamp, source, payload}   â† Oldest
   ]

task:queue:download                   â† Download tasks (list)
â””â”€ LIST: [task1, task2, ...]

task:queue:translate                  â† Translation tasks (list)
â””â”€ LIST: [task1, task2, ...]
```

---

## Status Transitions

```
DOWNLOAD_QUEUED â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> DOWNLOAD_IN_PROGRESS
                                     â”‚
                                     â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                                 â”‚
                    â”‚                                 â”‚
              Subtitle Found               Subtitle Not Found
                    â”‚                                 â”‚
                    â–¼                                 â–¼
                  DONE                      TRANSLATE_QUEUED
                                                     â”‚
                                                     â–¼
                                          TRANSLATE_IN_PROGRESS
                                                     â”‚
                                                     â–¼
                                                   DONE

                            Any Stage
                                â”‚
                                â”‚ Error
                                â–¼
                            FAILED
```

---

## Testing Verification Points

### âœ… What to Check at Each Step

**After Job Submission:**
- [ ] Job ID returned
- [ ] Status = DOWNLOAD_QUEUED
- [ ] Job exists in Redis
- [ ] Event published to RabbitMQ

**During Processing:**
- [ ] Status updates correctly
- [ ] Events published for each stage
- [ ] Consumer receives events
- [ ] Redis updated by consumer

**After Completion:**
- [ ] Final status = DONE (or FAILED)
- [ ] All events recorded in order
- [ ] Event count matches expected
- [ ] TTL set on Redis keys

**RabbitMQ:**
- [ ] Exchange exists
- [ ] Queue has consumer
- [ ] Messages flowing
- [ ] Bindings correct

**Redis:**
- [ ] Job data complete
- [ ] Event history populated
- [ ] Correct data types
- [ ] TTL configured

---

## Performance Metrics

### Expected Timing

**Subtitle Found Flow:**
- Job submission: < 100ms
- Status update (queued â†’ in_progress): ~1s
- Download completion: ~2-3s
- Event processing: < 500ms
- **Total: ~3-4 seconds**

**Translation Flow:**
- Job submission: < 100ms
- Download attempt: ~2s
- Translation queued: ~500ms
- Translation processing: ~3-5s
- Event processing: < 500ms
- **Total: ~6-8 seconds**

### Load Testing

**5 Concurrent Jobs:**
- All should complete within 10 seconds
- No queue backlog
- No errors

**10 Concurrent Jobs:**
- All should complete within 15 seconds
- Minimal queue backlog
- No errors

---

## Common Issues & Solutions

### Issue: Job Stuck in QUEUED
**Check:** Worker logs, RabbitMQ queue depth
**Solution:** Restart workers

### Issue: Events Not Recording
**Check:** Consumer logs, RabbitMQ bindings
**Solution:** Restart consumer, verify exchange

### Issue: Redis Connection Errors
**Check:** Redis health, connection string
**Solution:** Restart Redis, check .env

### Issue: RabbitMQ Connection Errors
**Check:** RabbitMQ health, credentials
**Solution:** Restart RabbitMQ, check .env

---

## Next Steps

1. âœ… Start services
2. âœ… Run health check
3. âœ… Submit test job
4. âœ… Watch progress
5. âœ… Verify events
6. âœ… Check all systems
7. âœ… Run load test
8. ğŸ‰ Celebrate!

**Ready to test? Start with:**
```bash
./scripts/test_manual.sh help
```

